<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="dist/css/playlist-demo.css">

<div class="mod">
    <div class="hd">播放列表及交互</div>
    <div class="bd">
        <ul id="playlist-demo">
            <li data-link="dist/mp3/rain.mp3"><i class="play-btn"></i>雨声</li>
            <li data-link="dist/mp3/walking.mp3"><i class="play-btn"></i>走路声</li>
        </ul>
        <script src="https://gist.github.com/hustKiwi/d4cb4eab9402ff56e28f.js"></script>
    </div>
</div>

<script src="bower_components/jquery/jquery.min.js"></script>
<script src="dist/js/player.js"></script>
<script>
// 通过全局变量的方式初始化
var player = new _mu.Player({
        mode: 'list',
        engines: [
            {
                constructor: 'FlashMP4Core'
            }
        ]
    }),
    $pl = $('#playlist-demo'),
    reset = function() {
        $pl.find('> li').removeClass('playing pause')
            .find('.time').remove();
    },
    findCurrItem = function() {
        return $pl.find('[data-link="' + player.getCur() + '"]');
    },
    $time = $('<span class="time"></span>'),

    // 获得资源的绝对路径
    // 参考: http://grack.com/blog/2009/11/17/absolutizing-url-in-javascript/
    toAbsoluteUrl = function (url) {
        var div = document.createElement('div');
        div.innerHTML = '<a></a>';
        div.firstChild.href = url;
        div.innerHTML = div.innerHTML;
        return div.firstChild.href;
    };

$pl.on('click', '> li', function() {
    if ($(this).hasClass('playing')) {
        player.pause();
    } else {
        var link = toAbsoluteUrl($(this).data('link'));
        player.reset().add(link).play();
    }
});

player.on('playing pause', function() {
    reset();
    findCurrItem().addClass(player.getState()).append($time);
}).on('ended', function() {
    player.stop();
    reset();
}).on('timeupdate', function() {
    $time.text(player.curPos(true) + ' / ' + player.duration(true));
});
</script>
