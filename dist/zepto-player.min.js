// @license
// Baidu Music Player: 0.9.2
// -------------------------
// (c) 2014 FE Team of Baidu Music
// Can be freely distributed under the BSD license.
(function(t){t.Callbacks=function(e){e=t.extend({},e);var n,i,r,o,s,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t;i=true;u=o||0;o=0;s=a.length;r=true;for(;a&&u<s;++u){if(a[u].apply(t[0],t[1])===false&&e.stopOnFalse){n=false;break}}r=false;if(a){if(f)f.length&&l(f.shift());else if(n)a.length=0;else c.disable()}},c={add:function(){if(a){var i=a.length,u=function(n){t.each(n,function(t,n){if(typeof n==="function"){if(!e.unique||!c.has(n))a.push(n)}else if(n&&n.length&&typeof n!=="string")u(n)})};u(arguments);if(r)s=a.length;else if(n){o=i;l(n)}}return this},remove:function(){if(a){t.each(arguments,function(e,n){var i;while((i=t.inArray(n,a,i))>-1){a.splice(i,1);if(r){if(i<=s)--s;if(i<=u)--u}}})}return this},has:function(e){return!!(a&&(e?t.inArray(e,a)>-1:a.length))},empty:function(){s=a.length=0;return this},disable:function(){a=f=n=undefined;return this},disabled:function(){return!a},lock:function(){f=undefined;if(!n)c.disable();return this},locked:function(){return!f},fireWith:function(t,e){if(a&&(!i||f)){e=e||[];e=[t,e.slice?e.slice():e];if(r)f.push(e);else l(e)}return this},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!i}};return c}})(Zepto);(function(t){var e=Array.prototype.slice;function n(e){var i=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){s.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return n(function(n){t.each(i,function(i,r){var u=t.isFunction(e[i])&&e[i];s[r[1]](function(){var e=u&&u.apply(this,arguments);if(e&&t.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{var i=this===o?n.promise():this,s=u?[e]:arguments;n[r[0]+"With"](i,s)}})});e=null}).promise()},promise:function(e){return e!=null?t.extend(e,o):o}},s={};t.each(i,function(t,e){var n=e[2],u=e[3];o[e[1]]=n.add;if(u){n.add(function(){r=u},i[t^1][2].disable,i[2][2].lock)}s[e[0]]=function(){s[e[0]+"With"](this===s?o:this,arguments);return this};s[e[0]+"With"]=n.fireWith});o.promise(s);if(e)e.call(s,s);return s}t.when=function(i){var r=e.call(arguments),o=r.length,s=0,u=o!==1||i&&t.isFunction(i.promise)?o:0,a=u===1?i:n(),f,l,c,p=function(t,n,i){return function(r){n[t]=this;i[t]=arguments.length>1?e.call(arguments):r;if(i===f){a.notifyWith(n,i)}else if(!--u){a.resolveWith(n,i)}}};if(o>1){f=new Array(o);l=new Array(o);c=new Array(o);for(;s<o;++s){if(r[s]&&t.isFunction(r[s].promise)){r[s].promise().done(p(s,c,r)).fail(a.reject).progress(p(s,l,f))}else{--u}}}if(!u)a.resolveWith(c,r);return a.promise()};t.Deferred=n})(Zepto);(function(t){var e=Object.prototype,n=e.toString;t.isString=function(t){return n.call(t)==="[object String]"};t.isNumeric=function(t){return n.call(t)==="[object Number]"};t.getScript=function(e,n){var i=document,r=i.createElement("script");r.async="async";if(!n){n={}}else if(t.isFunction(n)){n={callback:n}}if(n.charset){r.charset=n.charset}r.src=e;var o=i.getElementsByTagName("head")[0];r.onload=r.onreadystatechange=function(t,e){if(e||!r.readyState||/loaded|complete/.test(r.readyState)){r.onload=r.onreadystatechange=null;if(o&&r.parentNode){o.removeChild(r)}r=undefined;if(!e&&n.callback){n.callback()}}};o.insertBefore(r,o.firstChild)}})(Zepto);(function(t,e){if(typeof t._mu==="undefined"){t._mu={}}if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/cfg",e)}else{return t._mu.cfg=e()}})(this,function(){var t;t=this;return $.extend({namespace:t._mu,debug:false,version:"0.9.2",timerResolution:25,cdn:"http://apps.bdimg.com/libs/muplayer/",engine:{TYPES:{FLASH_MP3:"FlashMP3Core",FLASH_MP4:"FlashMP4Core",AUDIO:"AudioCore"},EVENTS:{STATECHANGE:"engine:statechange",POSITIONCHANGE:"engine:postionchange",PROGRESS:"engine:progress",ERROR:"engine:error",INIT:"engine:init",INIT_FAIL:"engine:init_fail",WAITING_TIMEOUT:"engine:waiting_timeout"},STATES:{CANPLAYTHROUGH:"canplaythrough",PREBUFFER:"waiting",BUFFERING:"loadeddata",PLAYING:"playing",PAUSE:"pause",STOP:"suspend",END:"ended"},ERRCODE:{MEDIA_ERR_ABORTED:"1",MEDIA_ERR_NETWORK:"2",MEDIA_ERR_DECODE:"3",MEDIA_ERR_SRC_NOT_SUPPORTED:"4"}}},typeof t._mu==="undefined"?{}:t._mu.cfg)});(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/utils",["muplayer/core/cfg"],e)}else{return t._mu.utils=e(t._mu.cfg)}})(this,function(t){var e,n,i,r,o,s,u,a,f,l,c,p;f={};r=String.prototype;n=Number.prototype;i=Object.prototype;e=Array.prototype;u=e.push;o=i.hasOwnProperty;a=i.toString;p=["Arguments","Function","String","Number","Date","RegExp"];for(l=0,c=p.length;l<c;l++){s=p[l];f["is"+s]=function(t){return function(e){return a.call(e)==="[object "+t+"]"}}(s)}if(!$.isFunction(r.startsWith)){r.startsWith=function(t){return this.slice(0,t.length)===t}}if(!$.isFunction(r.endsWith)){r.endsWith=function(t){return this.slice(-t.length)===t}}n.toFixed=function(t){var e,n,i;i=Math.pow(10,t);e=(Math.round(this*i)/i).toString();if(t===0){return e}if(e.indexOf(".")<0){e+="."}n=t+1-(e.length-e.indexOf("."));while(n--){e+="0"}return e};$.extend(f,{isBoolean:function(t){return t===true||t===false||a.call(t)==="[object Boolean]"},has:function(t,e){return o.call(t,e)},random:function(t,e){if(!e){e=t;t=0}return t+Math.floor(Math.random()*(e-t+1))},shuffle:function(t){var e,n,i,r,o,s;e=0;r=[];for(o=0,s=t.length;o<s;o++){n=t[o];i=this.random(e++);r[e-1]=r[i];r[i]=n}return r},time2str:function(t){var e,n,i,r,o,s;o=[];e=Math.floor;t=Math.round(t);n=e(t/3600);i=e((t-3600*n)/60);s=t%60;r=function(t){return function(t,e){var n,i,r;i="";n="";if(t<0){n="-"}r=String(Math.abs(t));if(r.length<e){i=new Array(e-r.length+1).join("0")}return n+i+r}}(this);if(n){o.push(n)}o.push(r(i,2));o.push(r(s,2));return o.join(":")},namespace:function(){var e,n,i,r,o,s,u,a,f,l;e=arguments;u=".";for(a=0,f=e.length;a<f;a++){n=e[a];s=t.namespace;if(n.indexOf(u)>-1){i=n.split(u);l=[0,i.length],r=l[0],o=l[1];while(r<o){s[i[r]]=s[i[r]]||{};s=s[i[r]];r++}}else{s[n]=s[n]||{};s=s[n]}}return s},wrap:function(t,e){return function(){var n;n=[t];u.apply(n,arguments);return e.apply(this,n)}},toAbsoluteUrl:function(t){var e;e=document.createElement("div");e.innerHTML="<a></a>";e.firstChild.href=t;e.innerHTML=e.innerHTML;return e.firstChild.href}});return f});(function(t,e){if(typeof exports==="object"){module.exports=e()}else if(typeof define==="function"&&define.amd){define("muplayer/lib/Timer",e)}else{t._mu.Timer=e()}})(this,function(){function t(t){if(typeof t==="string"){if(isNaN(parseInt(t,10))){t="1"+t}var e=t.replace(/[^a-z0-9\.]/g,"").match(/(?:(\d+(?:\.\d+)?)(?:days?|d))?(?:(\d+(?:\.\d+)?)(?:hours?|hrs?|h))?(?:(\d+(?:\.\d+)?)(?:minutes?|mins?|m\b))?(?:(\d+(?:\.\d+)?)(?:seconds?|secs?|s))?(?:(\d+(?:\.\d+)?)(?:milliseconds?|ms))?/);if(e[0]){return parseFloat(e[1]||0)*864e5+parseFloat(e[2]||0)*36e5+parseFloat(e[3]||0)*6e4+parseFloat(e[4]||0)*1e3+parseInt(e[5]||0,10)}if(!isNaN(parseInt(t,10))){return parseInt(t,10)}}if(typeof t==="number"){return t}return 0}function e(t,e){return parseInt(t/e,10)||1}function n(e){if(this instanceof n===false){return new n(e)}this._notifications=[];this._resolution=t(e)||1e3;this._running=false;this._ticks=0;this._timer=null;this._drift=0}n.prototype={start:function(){var t=this;if(!this._running){this._running=!this._running;setTimeout(function e(){t._ticks++;for(var n=0,i=t._notifications.length;n<i;n++){if(t._notifications[n]&&t._ticks%t._notifications[n].ticks===0){t._notifications[n].callback.call(t._notifications[n],{ticks:t._ticks,resolution:t._resolution})}}if(t._running){clearTimeout(t._timer);t._timer=setTimeout(e,t._resolution+t._drift);t._drift=0}},this._resolution)}return this},stop:function(){if(this._running){this._running=!this._running;clearTimeout(this._timer)}return this},reset:function(){this.stop();this._ticks=0;return this},clear:function(){this.reset();this._notifications=[];return this},ticks:function(){return this._ticks},resolution:function(){return this._resolution},running:function(){return this._running},bind:function(n,i){if(n&&i){var r=e(t(n),this._resolution);this._notifications.push({ticks:r,callback:i})}return this},unbind:function(t){if(!t){this._notifications=[]}else{for(var e=0,n=this._notifications.length;e<n;e++){if(this._notifications[e]&&this._notifications[e].callback===t){this._notifications.splice(e,1)}}}return this},drift:function(t){this._drift=t;return this}};n.prototype.every=n.prototype.bind;n.prototype.after=function(t,e){var i=this;n.prototype.bind.call(i,t,function r(){n.prototype.unbind.call(i,r);e.apply(this,arguments)});return this};return n});(function(t,e){if(typeof exports==="object"){module.exports=e()}else if(typeof define==="function"&&define.amd){define("muplayer/lib/events",e)}else{t._mu.Events=e()}})(this,function(){var t=/\s+/;function e(){}e.prototype.on=function(e,n,i){var r,o,s;if(!n)return this;r=this.__events||(this.__events={});e=e.split(t);while(o=e.shift()){s=r[o]||(r[o]=[]);s.push(n,i)}return this};e.prototype.once=function(t,e,n){var i=this;var r=function(){i.off(t,r);e.apply(this,arguments)};this.on(t,r,n)};e.prototype.off=function(e,i,r){var o,s,u,a;if(!(o=this.__events))return this;if(!(e||i||r)){delete this.__events;return this}e=e?e.split(t):n(o);while(s=e.shift()){u=o[s];if(!u)continue;if(!(i||r)){delete o[s];continue}for(a=u.length-2;a>=0;a-=2){if(!(i&&u[a]!==i||r&&u[a+1]!==r)){u.splice(a,2)}}}return this};e.prototype.trigger=function(e){var n,r,o,s,u,a,f=[],l,c=true;if(!(n=this.__events))return this;e=e.split(t);for(u=1,a=arguments.length;u<a;u++){f[u-1]=arguments[u]}while(r=e.shift()){if(o=n.all)o=o.slice();if(s=n[r])s=s.slice();c=i(s,f,this)&&c;c=i(o,[r].concat(f),this)&&c}return c};e.prototype.emit=e.prototype.trigger;e.mixTo=function(t){t=r(t)?t.prototype:t;var n=e.prototype;for(var i in n){if(n.hasOwnProperty(i)){t[i]=n[i]}}};var n=Object.keys;if(!n){n=function(t){var e=[];for(var n in t){if(t.hasOwnProperty(n)){e.push(n)}}return e}}function i(t,e,n){if(t){var i=0,r=t.length,o=e[0],s=e[1],u=e[2],a=true;switch(e.length){case 0:for(;i<r;i+=2){a=t[i].call(t[i+1]||n)!==false&&a}break;case 1:for(;i<r;i+=2){a=t[i].call(t[i+1]||n,o)!==false&&a}break;case 2:for(;i<r;i+=2){a=t[i].call(t[i+1]||n,o,s)!==false&&a}break;case 3:for(;i<r;i+=2){a=t[i].call(t[i+1]||n,o,s,u)!==false&&a}break;default:for(;i<r;i+=2){a=t[i].apply(t[i+1]||n,e)!==false&&a}break}}return a}function r(t){return Object.prototype.toString.call(t)==="[object Function]"}return e});var __bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++){if(e in this&&this[e]===t)return e}return-1};(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/playlist",["muplayer/core/utils","muplayer/lib/events"],e)}else{return t._mu.Playlist=e(_mu.utils,_mu.Events)}})(this,function(t,e){var n;n=function(){function e(t){this.next=__bind(this.next,this);this.prev=__bind(this.prev,this);this.opts=$.extend({},this.defaults,t);this.reset()}e.prototype.reset=function(){this.cur="";if($.isArray(this.list)){return this.list.length=0}else{return this.list=[]}};e.prototype._resetListRandom=function(e){var n,i,r;if(this.mode==="list-random"){e=e||0;this._listRandomIndex=e;this._listRandom=t.shuffle(function(){r=[];for(var t=0,e=this.list.length;0<=e?t<e:t>e;0<=e?t++:t--){r.push(t)}return r}.apply(this));return this.cur=this.list[this._listRandom[e]]}};e.prototype._formatSid=function(e){var n,i,r;n=this.opts.absoluteUrl;i=function(e){return n&&t.toAbsoluteUrl(e)||""+e};return $.isArray(e)&&function(){var t,n,o;o=[];for(t=0,n=e.length;t<n;t++){r=e[t];if(r){o.push(i(r))}}return o}()||i(e)};e.prototype.setMode=function(t){if(t==="single"||t==="random"||t==="list-random"||t==="list"||t==="loop"){this.mode=t}return this._resetListRandom()};e.prototype.add=function(t,e){if(e==null){e=true}t=this._formatSid(t);this.remove(t);if($.isArray(t)&&t.length){this.list=e&&t.concat(this.list)||this.list.concat(t)}else if(t){this.list[e&&"unshift"||"push"](t)}this.trigger("playlist:add",t);return this._resetListRandom()};e.prototype.remove=function(t){var e,n,i,r;n=function(t){return function(e){var n;n=$.inArray(e,t.list);if(n!==-1){return t.list.splice(n,1)}}}(this);t=this._formatSid(t);if($.isArray(t)){for(i=0,r=t.length;i<r;i++){e=t[i];n(e)}}else{n(t)}this.trigger("playlist:remove",t);return this._resetListRandom()};e.prototype.prev=function(){var e,n,i,r;i=this.list;e=$.inArray(this.cur,i);n=i.length;r=e-1;switch(this.mode){case"single":r=e;break;case"random":r=t.random(0,n-1);break;case"list":if(e=0){this.cur="";return false}break;case"list-random":e=this._listRandomIndex--;r=e-1;if(e===0){r=n-1;this._resetListRandom(r)}return this.cur=i[this._listRandom[r]];case"loop":if(e===0){r=n-1}}return this.cur=i[r]};e.prototype.next=function(){var e,n,i,r;i=this.list;e=$.inArray(this.cur,i);n=i.length;r=e+1;switch(this.mode){case"single":r=e;break;case"random":r=t.random(0,n-1);break;case"list":if(e===n-1){this.cur="";return false}break;case"list-random":e=this._listRandomIndex++;r=e+1;if(e===n-1){r=0;this._resetListRandom(r)}return this.cur=i[this._listRandom[r]];case"loop":if(e===n-1){r=0}}return this.cur=i[r]};e.prototype.setCur=function(t){t=this._formatSid(t);if(__indexOf.call(this.list,t)<0){this.add(t)}return this.cur=t};return e}();e.mixTo(n);return n});var __indexOf=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++){if(e in this&&this[e]===t)return e}return-1};(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/engines/engineCore",["muplayer/core/cfg","muplayer/core/utils","muplayer/lib/events"],e)}else{return t._mu.EngineCore=e(_mu.cfg,_mu.utils,_mu.Events)}})(this,function(t,e,n){var i,r,o,s,u,a,f;f=t.engine,i=f.EVENTS,o=f.STATES;s=function(){var t;t=[];for(u in o){a=o[u];t.push(a)}return t}();r=function(){function t(){}t.prototype._supportedTypes=[];t.prototype.getSupportedTypes=function(){return this._supportedTypes};t.prototype.canPlayType=function(t){return $.inArray(t,this.getSupportedTypes())!==-1};t.prototype.reset=function(){this.stop();this.setUrl();this.trigger(i.PROGRESS,0);return this.trigger(i.POSITIONCHANGE,0)};t.prototype.play=function(){return this};t.prototype.pause=function(){return this};t.prototype.stop=function(){return this};t.prototype.setUrl=function(t){if(t==null){t=""}this._url=t;return this};t.prototype.getUrl=function(){return this._url};t.prototype.setState=function(t){var e,n;if(__indexOf.call(s,t)<0||t===this._state){return}if(t===o.BUFFERING&&((n=this._state)===o.END||n===o.PAUSE||n===o.STOP)){return}e=this._state;this._state=t;return this.trigger(i.STATECHANGE,{oldState:e,newState:t})};t.prototype.getState=function(){return this._state};t.prototype.setVolume=function(t){this._volume=t;return this};t.prototype.getVolume=function(){return this._volume};t.prototype.setMute=function(t){this._mute=t;return this};t.prototype.getMute=function(){return this._mute};t.prototype.setCurrentPosition=function(t){return this};t.prototype.getCurrentPosition=function(){return 0};t.prototype.getLoadedPercent=function(){return 0};t.prototype.getTotalTime=function(){return 0};return t}();n.mixTo(r);return r});(function(t,e){if(typeof exports==="object"){module.exports=e()}else if(typeof define==="function"&&define.amd){define("muplayer/lib/modernizr.audio",e)}else{t._mu.Modernizr=e()}})(this,function(){return function(t,e,n){var i="2.7.1",r={},o=e.documentElement,s="modernizr",u=e.createElement(s),a=u.style,f,l={}.toString,c={},p={},h={},g=[],y=g.slice,d,m={}.hasOwnProperty,E;if(!v(m,"undefined")&&!v(m.call,"undefined")){E=function(t,e){return m.call(t,e)}}else{E=function(t,e){return e in t&&v(t.constructor.prototype[e],"undefined")}}if(!Function.prototype.bind){Function.prototype.bind=function A(t){var e=this;if(typeof e!="function"){throw new TypeError}var n=y.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=e.prototype;var o=new r;var s=e.apply(o,n.concat(y.call(arguments)));if(Object(s)===s){return s}return o}else{return e.apply(t,n.concat(y.call(arguments)))}};return i}}function _(t){a.cssText=t}function T(t,e){return _(prefixes.join(t+";")+(e||""))}function v(t,e){return typeof t===e}function S(t,e){return!!~(""+t).indexOf(e)}function P(t,e,i){for(var r in t){var o=e[t[r]];if(o!==n){if(i===false)return t[r];if(v(o,"function")){return o.bind(i||e)}return o}}return false}c["audio"]=function(){var t=e.createElement("audio"),n=false;try{if(n=!!t.canPlayType){n=new Boolean(n);n.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");n.mp3=t.canPlayType("audio/mpeg;").replace(/^no$/,"");n.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");n.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(i){}return n};for(var b in c){if(E(c,b)){d=b.toLowerCase();r[d]=c[b]();g.push((r[d]?"":"no-")+d)}}r.addTest=function(t,e){if(typeof t=="object"){for(var i in t){if(E(t,i)){r.addTest(i,t[i])}}}else{t=t.toLowerCase();if(r[t]!==n){return r}e=typeof e=="function"?e():e;if(typeof enableClasses!=="undefined"&&enableClasses){o.className+=" "+(e?"":"no-")+t}r[t]=e}return r};_("");u=f=null;r._version=i;return r}(this,this.document)});var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var n in e){if(__hasProp.call(e,n))t[n]=e[n]}function i(){this.constructor=t}i.prototype=e.prototype;t.prototype=new i;t.__super__=e.prototype;return t},__slice=[].slice;(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/engines/audioCore",["muplayer/core/cfg","muplayer/core/utils","muplayer/core/engines/engineCore","muplayer/lib/modernizr.audio"],e)}else{return t._mu.AudioCore=e(_mu.cfg,_mu.utils,_mu.EngineCore,_mu.Modernizr)}})(this,function(t,e,n,i){var r,o,s,u,a,f,l;f=window;l=t.engine,a=l.TYPES,s=l.EVENTS,u=l.STATES,o=l.ERRCODE;r=function(t){__extends(n,t);n.defaults={confidence:"maybe",preload:false,autoplay:false,needPlayEmpty:true,emptyMP3:"empty.mp3"};n.prototype._supportedTypes=[];n.prototype.engineType=a.AUDIO;function n(t){var e,r,o,s,a,l,c;this.opts=$.extend({},n.defaults,t);this.opts.emptyMP3=this.opts.baseDir+this.opts.emptyMP3;a=this.opts;s={"":0,maybe:1,probably:2};o=s[a.confidence];e=i.audio;if(!e){return this}for(r in e){c=e[r];if(s[c]>=o){this._supportedTypes.push(r)}}e=new Audio;e.preload=a.preload;e.autoplay=a.autoplay;e.loop=false;e.on=function(t,n){e.addEventListener(t,n,false);return e};e.off=function(t,n){e.removeEventListener(t,n,false);return e};this.audio=e;this._needCanPlay(["play","setCurrentPosition"]);this.setState(u.STOP);this._initEvents();if(a.needPlayEmpty){l=function(t){return function(){if(!t.getUrl()){t.setUrl(a.emptyMP3).play()}return f.removeEventListener("touchstart",l,false)}}(this);f.addEventListener("touchstart",l,false)}}n.prototype._test=function(){if(!i.audio||!this._supportedTypes.length){return false}return true};n.prototype._initEvents=function(){var t,e,n,i,r,o,a,f;o=this;t=this.audio,a=this.trigger;f=[null,null,false],n=f[0],r=f[1],e=f[2];this.trigger=function(t,e){if(o.getUrl()!==o.opts.emptyMP3){return a.call(o,t,e)}};i=function(t){t=t||o.getLoadedPercent();o.trigger(s.PROGRESS,t);if(t===1){clearInterval(r);e=true;return o.setState(u.CANPLAYTHROUGH)}};return t.on("loadstart",function(){e=false;clearInterval(r);r=setInterval(function(){return i()},50);return o.setState(u.PREBUFFER)}).on("playing",function(){clearTimeout(n);return o.setState(u.PLAYING)}).on("pause",function(){return o.setState(o.getCurrentPosition()&&u.PAUSE||u.STOP)}).on("ended",function(){return o.setState(u.END)}).on("error",function(t){clearTimeout(n);return n=setTimeout(function(){return o.trigger(s.ERROR,t)},2e3)}).on("waiting",function(){return o.setState(u.PREBUFFER)}).on("loadeddata",function(){return o.setState(u.BUFFERING)}).on("timeupdate",function(){return o.trigger(s.POSITIONCHANGE,o.getCurrentPosition())}).on("progress",function(t){var n,o;clearInterval(r);if(!e){n=t.loaded||0;o=t.total||1;return i(n&&(n/o).toFixed(2)*1)}})};n.prototype._needCanPlay=function(t){var n,i,r,o,s,u;r=this;n=this.audio;u=[];for(o=0,s=t.length;o<s;o++){i=t[o];u.push(this[i]=e.wrap(this[i],function(){var t,e,i;e=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[];try{e.apply(r,t)}catch(o){i=function(){e.apply(r,t);return n.off("canplay",i)};n.on("canplay",i)}return r}))}return u};n.prototype.play=function(){this.audio.play();return this};n.prototype.pause=function(){this.audio.pause();return this};n.prototype.stop=function(){try{this.audio.currentTime=0}catch(t){}finally{this.pause()}return this};n.prototype.setUrl=function(t){if(t){this.audio.src=t;this.audio.load()}return n.__super__.setUrl.call(this,t)};n.prototype.setVolume=function(t){this.audio.volume=t/100;return n.__super__.setVolume.call(this,t)};n.prototype.setMute=function(t){this.audio.muted=t;return n.__super__.setMute.call(this,t)};n.prototype.setCurrentPosition=function(t){try{this.audio.currentTime=t/1e3}catch(e){}finally{this.play()}return this};n.prototype.getCurrentPosition=function(){return this.audio.currentTime*1e3};n.prototype.getLoadedPercent=function(){var t,e,n,i,r,o;t=this.audio;e=t.currentTime;i=t.buffered;if(i){n=i.length;while(n--){if(i.start(n)<=(o=t.currentTime)&&o<=i.end(n)){e=i.end(n);break}}}r=this.getTotalTime()/1e3;e=e>r?r:e;return r&&(e/r).toFixed(2)*1||0};n.prototype.getTotalTime=function(){var t,e,n,i,r;r=this.audio,i=r.duration,e=r.buffered,n=r.currentTime;i=~~i;if(i===0&&e){t=e.length;if(t>0){i=e.end(--t)}else{i=n}}return i&&i*1e3||0};return n}(n);return r});(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/core/engines/engine",["muplayer/core/cfg","muplayer/core/utils","muplayer/lib/events","muplayer/core/engines/engineCore","muplayer/core/engines/audioCore"],e)}else{return t._mu.Engine=e(_mu.cfg,_mu.utils,_mu.Events,_mu.EngineCore,_mu.AudioCore)}})(this,function(cfg,utils,Events,EngineCore,AudioCore,FlashMP3Core,FlashMP4Core){var EVENTS,Engine,STATES,extReg,timerResolution,_ref;_ref=cfg.engine,EVENTS=_ref.EVENTS,STATES=_ref.STATES;timerResolution=cfg.timerResolution;extReg=/\.(\w+)(\?.*)?$/;Engine=function(){Engine.el='<div id="muplayer_container_{{DATETIME}}" style="width: 1px; height: 1px; overflow: hidden"></div>';Engine.prototype.defaults={engines:[{constructor:AudioCore}]};function Engine(t){this.opts=$.extend({},this.defaults,t);this._initEngines()}Engine.prototype._initEngines=function(){var $el,args,constructor,engine,i,opts,_i,_len,_ref1;this.engines=[];opts=this.opts;$el=$(Engine.el.replace(/{{DATETIME}}/g,+new Date)).appendTo("body");_ref1=opts.engines;for(i=_i=0,_len=_ref1.length;_i<_len;i=++_i){engine=_ref1[i];constructor=engine.constructor;args=engine.args||{};args.baseDir=opts.baseDir;args.$el=$el;try{if(!$.isFunction(constructor)){constructor=eval(constructor)}engine=new constructor(args)}catch(_error){throw"Missing constructor: "+String(engine.constructor)}if(engine._test()){this.engines.push(engine)}}if(this.engines.length){return this.setEngine(this.engines[0])}else{return this.setEngine(new EngineCore)}};Engine.prototype.setEngine=function(t){var e,n,i,r,o,s,u,a;s=this;this._lastE={};u=function(t){var e,n;e=t.newState,n=t.oldState;if(n===s._lastE.oldState&&e===s._lastE.newState){return}s._lastE={oldState:n,newState:e};s.trigger(EVENTS.STATECHANGE,t);if(e===STATES.CANPLAYTHROUGH&&(n===STATES.PLAYING||n===STATES.PAUSE)){return s.setState(n)}};r=function(t){return s.trigger(EVENTS.POSITIONCHANGE,t)};o=function(t){return s.trigger(EVENTS.PROGRESS,t)};n=function(t){return s.trigger(EVENTS.ERROR,t)};e=function(t){return t.on(EVENTS.STATECHANGE,u).on(EVENTS.POSITIONCHANGE,r).on(EVENTS.PROGRESS,o).on(EVENTS.ERROR,n)};a=function(t){return t.off(EVENTS.STATECHANGE,u).off(EVENTS.POSITIONCHANGE,r).off(EVENTS.PROGRESS,o).off(EVENTS.ERROR,n)};if(!this.curEngine){return this.curEngine=e(t)}else if(this.curEngine!==t){i=this.curEngine;a(i).reset();this.curEngine=e(t);return this.curEngine.setVolume(i.getVolume()).setMute(i.getMute())}};Engine.prototype.canPlayType=function(t){return $.inArray(t,this.getSupportedTypes())!==-1};Engine.prototype.getSupportedTypes=function(){var t,e,n,i,r;e=[];r=this.engines;for(n=0,i=r.length;n<i;n++){t=r[n];e=e.concat(t.getSupportedTypes())}return e};Engine.prototype.switchEngineByType=function(t){var e,n,i,r,o;n=false;o=this.engines;for(i=0,r=o.length;i<r;i++){e=o[i];if(e.canPlayType(t)){this.setEngine(e);n=true;break}}if(!n){return this.setEngine(this.engines[0])}};Engine.prototype.reset=function(){this.curEngine.reset();return this};Engine.prototype.setUrl=function(t){var e;if(extReg.test(t)){e=RegExp.$1.toLocaleLowerCase()}if(this.canPlayType(e)){if(!this.curEngine.canPlayType(e)){this.switchEngineByType(e)}}else{throw new Error("Can not play with: "+e)}this.curEngine.setUrl(t);return this};Engine.prototype.getUrl=function(){return this.curEngine.getUrl()};Engine.prototype.play=function(){this.curEngine.play();return this};Engine.prototype.pause=function(){this.curEngine.pause();this.trigger(EVENTS.POSITIONCHANGE,this.getCurrentPosition());this.setState(STATES.PAUSE);return this};Engine.prototype.stop=function(){this.curEngine.stop();this.trigger(EVENTS.POSITIONCHANGE,0);this.setState(STATES.STOP);return this};Engine.prototype.setState=function(t){this.curEngine.setState(t);return this};Engine.prototype.getState=function(){return this.curEngine.getState()};Engine.prototype.setMute=function(t){this.curEngine.setMute(!!t);return this};Engine.prototype.getMute=function(){return this.curEngine.getMute()};Engine.prototype.setVolume=function(t){if($.isNumeric(t)&&t>=0&&t<=100){this.curEngine.setVolume(t)}return this};Engine.prototype.getVolume=function(){return this.curEngine.getVolume()};Engine.prototype.setCurrentPosition=function(t){t=~~t;this.curEngine.setCurrentPosition(t);return this};Engine.prototype.getCurrentPosition=function(){return this.curEngine.getCurrentPosition()};Engine.prototype.getLoadedPercent=function(){return this.curEngine.getLoadedPercent()};Engine.prototype.getTotalTime=function(){return this.curEngine.getTotalTime()};Engine.prototype.getEngineType=function(){return this.curEngine.engineType};Engine.prototype.getState=function(){return this.curEngine.getState()};return Engine}();Events.mixTo(Engine);return Engine});(function(t,e){if(typeof exports==="object"){return module.exports=e()}else if(typeof define==="function"&&define.amd){return define("muplayer/player",["muplayer/core/cfg","muplayer/core/utils","muplayer/lib/Timer","muplayer/lib/events","muplayer/core/playlist","muplayer/core/engines/engine"],e)}else{return t._mu.Player=e(_mu.cfg,_mu.utils,_mu.Timer,_mu.Events,_mu.Playlist,_mu.Engine)}})(this,function(t,e,n,i,r,o){var s,u,a,f,l,c;c=t.engine,s=c.EVENTS,a=c.STATES;l=e.time2str;f=function(t,e){var n,i;if(t!=="prev"&&t!=="next"){return this}this.stop();n=this.playlist;i=function(n){return function(){var i;i={cur:n.getCur()};if(e){i.auto=e}n.trigger("player:"+t,i);return n.play()}}(this);if(this.getSongsNum()){if(!n.cur){i()}else if(n[t]()){i()}}return this};u=function(){var e;e=null;i.defaults={baseDir:""+t.cdn+t.version,mode:"loop",mute:false,volume:80,singleton:true,absoluteUrl:true,maxRetryTimes:1,maxWaitingTime:4*1e3,recoverMethodWhenWaitingTimeout:"retry"};function i(t){var s,u;this.opts=u=$.extend({},i.defaults,t);this.waitingTimer=new n(100);s=u.baseDir;if(s===false){s=""}else if(!s){throw"baseDir must be set! Usually, it should point to the MuPlayer's dist directory."}if(s&&!s.endsWith("/")){s=s+"/"}if(u.singleton){if(e){return e}e=this}this.playlist=new r({absoluteUrl:u.absoluteUrl});this.playlist.setMode(u.mode);this._initEngine(new o({baseDir:s,engines:u.engines}));this.setMute(u.mute);this.setVolume(u.volume);this.reset()}i.prototype._initEngine=function(t){var e,n,i;i=this;e=this.opts;n=e.recoverMethodWhenWaitingTimeout;return this.engine=t.on(s.STATECHANGE,function(t){var e;e=t.newState;if(e!==a.PREBUFFER&&e!==a.BUFFERING){i.waitingTimer.clear()}i.trigger("player:statechange",t);i.trigger(e);if(e===a.END){return i.next(true)}}).on(s.POSITIONCHANGE,function(n){if(!n){return}i.trigger("timeupdate",n);if(i.getUrl()){return i.waitingTimer.clear().after(e.maxWaitingTime,function(){var e;if((e=i.getState())!==a.PAUSE&&e!==a.STOP&&e!==a.END){return t.trigger(s.WAITING_TIMEOUT)}}).start()}}).on(s.PROGRESS,function(t){return i.trigger("progress",t)}).on(s.ERROR,function(t){if(typeof console!=="undefined"&&console!==null){if(typeof console.error==="function"){console.error("error: ",t)}}return i.trigger("error",t)}).on(s.WAITING_TIMEOUT,function(){if(n==="retry"||n==="next"){i[n]()}return i.trigger("player:waiting_timeout")})};i.prototype.retry=function(){var t,e;if(this._retryTimes<this.opts.maxRetryTimes){this._retryTimes++;e=this.getUrl();t=this.engine.getCurrentPosition();this.pause().setUrl(e).engine.setCurrentPosition(t);this.trigger("player:retry",this._retryTimes)}else{this.trigger("player:retry:max")}return this};i.prototype.play=function(t){var e,n,i,r,o;r=this;n=this.engine;e=$.Deferred();t=~~t;i=function(){return setTimeout(function(){if(r.getUrl()){if(t){n.setCurrentPosition(t)}else{n.play()}}r.trigger("player:play",t);return e.resolve()},0)};if(this._st!=="play"){this._st="play";o=this.getState();if(o===a.STOP||o===a.END||o===a.BUFFERING&&this.curPos()===0){this.trigger("player:fetch:start");this._fetch().done(function(){r.trigger("player:fetch:done");return i()})}else{i()}}return e.promise()};i.prototype.pause=function(){if(this._st!=="pause"){this._st="pause";this.engine.pause();this.trigger("player:pause")}return this};i.prototype.stop=function(){if(this._st!=="stop"){this._st="stop"}this.engine.stop();this.trigger("player:stop");return this};i.prototype.replay=function(){return this.stop().play()};i.prototype.prev=function(){return f.apply(this,["prev"])};i.prototype.next=function(t){return f.apply(this,["next",t])};i.prototype.getCur=function(){var t,e;e=this.playlist;t=e.cur;if(!t&&this.getSongsNum()){t=e.list[0];e.setCur(t)}return t+""};i.prototype.setCur=function(t){var e;e=this.playlist;if(!t&&this.getSongsNum()){t=e.list[0]}if(t&&this._sid!==t){e.setCur(t);this._sid=t;this.stop()}return this};i.prototype.curPos=function(t){var e;e=this.engine.getCurrentPosition()/1e3;if(t){return l(e)}else{return e}};i.prototype.duration=function(t){var e;e=this.engine.getTotalTime()/1e3;if(t){return l(e)}else{return e}};i.prototype.add=function(t,e){if(e==null){e=true}if(t){this.playlist.add(t,e)}this.trigger("player:add",t);return this};i.prototype.remove=function(t){if(t){this.playlist.remove(t)}if(!this.getSongsNum()){this.reset()}this.trigger("player:remove",t);return this};i.prototype.reset=function(){delete this._sid;this._retryTimes=0;this.playlist.reset();this.engine.reset();this.trigger("player:reset");return this};i.prototype.getState=function(){return this.engine.getState()};i.prototype.setUrl=function(t){if(!t){return this}this.stop().engine.setUrl(t);this.trigger("player:setUrl",t);return this};i.prototype.getUrl=function(){return this.engine.getUrl()};i.prototype.setVolume=function(t){this.engine.setVolume(t);this.trigger("player:setVolume",t);return this};i.prototype.getVolume=function(){return this.engine.getVolume()};i.prototype.setMute=function(t){this.engine.setMute(t);this.trigger("player:setMute",t);return this};i.prototype.getMute=function(){return this.engine.getMute()};i.prototype.canPlayType=function(t){return this.engine.canPlayType(t)};i.prototype.getSongsNum=function(){return this.playlist.list.length
};i.prototype.setMode=function(t){this.playlist.setMode(t);this.trigger("player:setMode",t);return this};i.prototype.getMode=function(){return this.playlist.mode};i.prototype.getEngineType=function(){return this.engine.curEngine.engineType};i.prototype._fetch=function(){var t,e;e=$.Deferred();t=this.getCur();if(this.getUrl()===t){e.resolve()}else{setTimeout(function(n){return function(){n.setUrl(t);return e.resolve()}}(this),0)}return e.promise()};return i}();i.mixTo(u);return u});